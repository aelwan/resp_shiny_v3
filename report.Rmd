---
#title: "report"
#author: "Pawel"
#date: "30 January 2019"
output: pdf_document
#output: pdf_document
#always_allow_html: yes
params:
  chart_line: NA
  chart_bar: NA
  map: NA
  wells: NA
  raster: NA
  labels: NA
  zone: NA
  time: NA
  pumping_type: NA
  abstr_type: NA
  period_type: NA
  date_range_hist: NA
  results_df: NA
  SD_per_bore: NA
  SD_per_river: NA
  SD_per_times: NA
  include_wells: NA
---

```{r echo = F}
library(lubridate)
```



# Stream depletion report
 generated on: `r Sys.time()`  
  
## Input data:  
**river:** `r params$zone`  
**time (days):** `r params$time`  
**pumping input:** `r params$pumping_type`  
**number of wells:** `r nrow(params$wells)`  
**abstraction type:** `r if(params$pumping_type == "historical data") {  toString(params$abstr_type)}else{NA}`  
**averaging period:** `r if(params$pumping_type == "historical data") {if(params$period_type == "dry summer 2012-2013"){"selected period: dry summer 2012-2013"}else if (params$period_type == "date range"){paste("selected period:", params$date_range_hist[1], "to", params$date_range_hist[2]) }}else{NA}`  
# RESULTS:  
for selected stream  
at selected time inteval  
for selected pumping location, rate and duration  
  
Stream Depletion in L/s  
Stream Depletion Ratio as % of pumping  
```{r echo = F}
library(knitr)
kable(params$results_df)
```

```{r echo = F}
library(tmap)
library(tmaptools)
library(OpenStreetMap)
#library(raster)
#library(sf)

#RF_poly1()
#wells1()
osm_map <- read_osm(params$raster,type ="stamen-terrain")

tm <- qtm(osm_map)+
  tm_shape(params$raster)+
  tm_raster(col = "SDR",
              breaks = seq(0,1,0.1),
              style = "fixed",
              palette = "-Spectral",
              alpha = 0.5,
              title = "stream depletion ratio")+
  tm_shape(params$wells)+
  tm_dots(size = "Q",
          col = "blue")+
  tm_compass(position = c("left","bottom"))+
  tm_scale_bar(position = c("left","bottom"))+
  tm_layout(legend.outside = T)
tm


```
******
# RESULTS per pumping bore  
```{r echo = F}
if(params$include_wells == T){ kable(params$SD_per_bore)}else{"user selected not to include wells"}
```
******
# Chart of stream depletion vs time  
depletion by selected puming  
for selected stream  
```{r echo = FALSE}
#params$map
params$chart_line
```
data for depletion vs time
```{r echo = FALSE}
#params$map
kable(params$SD_per_river)
```



******
# Chart of stream depletion per zone  
depletion by selected puming  
for selected time interval  
```{r echo = FALSE}
params$chart_bar
```
data for depletion vs zone
```{r echo = FALSE}
kable(params$SD_per_times)
```


